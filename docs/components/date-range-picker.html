<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Date Range Picker - Aural UI</title>

    <!-- Aural UI CSS -->
    <link rel="stylesheet" href="../aural-ui.css?v=10">

    <!-- Theme CSS -->
    <link rel="stylesheet" href="../dark.css" id="theme-link">

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }

        /* Main Content */
        .main-content {
            max-width: 900px;
            margin: 0 auto;
            padding: var(--space-8);
            min-height: 100vh;
        }

        .page-header {
            margin-bottom: var(--space-8);
        }

        .page-title {
            font-size: var(--text-3xl);
            font-weight: var(--font-bold);
            color: var(--color-text-primary);
            margin: 0 0 var(--space-4) 0;
        }

        .page-description {
            font-size: var(--text-lg);
            color: var(--color-text-secondary);
            line-height: 1.8;
            margin: 0;
        }

        /* Example Container */
        .example-container {
            margin-bottom: var(--space-8);
        }

        .example-label {
            font-size: var(--text-sm);
            font-weight: var(--font-semibold);
            color: var(--color-text-secondary);
            text-transform: uppercase;
            letter-spacing: var(--tracking-wide);
            margin-bottom: var(--space-3);
        }

        .example-demo {
            padding: var(--space-6);
            background: var(--color-bg-secondary);
            border: 1px solid var(--color-border-subtle);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-4);
        }

        /* Theme Toggle */
        .theme-toggle {
            position: fixed;
            top: var(--space-6);
            right: var(--space-6);
            z-index: 200;
        }

        /* Screen reader only */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        /* Mobile Styles */
        @media (max-width: 768px) {
            .main-content {
                padding: var(--space-6) var(--space-4);
            }

            .page-title {
                font-size: var(--text-2xl);
            }

            .page-description {
                font-size: var(--text-base);
            }

            .theme-toggle {
                top: var(--space-4);
                right: var(--space-4);
            }
        }
    </style>
</head>
<body>
    <!-- Main Content -->
    <main class="main-content">
        <!-- Screen reader announcements -->
        <div aria-live="polite" aria-atomic="true" class="sr-only" id="date-range-announcer"></div>

        <div class="page-header">
            <h1 class="page-title">Date Range Picker</h1>
            <p class="page-description">Select a start and end date with a visual calendar interface.</p>
        </div>

        <div class="example-container">
            <div class="example-label">Basic Date Range Picker</div>
            <div class="example-demo">
                <div class="aural-date-picker aural-date-picker--range" id="date-range-picker-1">
                    <div class="aural-date-picker__input-wrapper">
                        <input type="text"
                               class="aural-date-picker__input"
                               placeholder="Select date range"
                               readonly
                               aria-label="Select date range"
                               aria-haspopup="dialog"
                               aria-expanded="false">
                        <i data-lucide="calendar" class="aural-date-picker__icon" aria-hidden="true"></i>
                    </div>
                    <div class="aural-date-picker__calendar" role="dialog" aria-label="Date range picker">
                        <div class="aural-date-picker__header">
                            <button class="aural-date-picker__nav-button"
                                    data-action="prev-month"
                                    aria-label="Previous month"
                                    type="button">
                                <i data-lucide="chevron-left" aria-hidden="true"></i>
                            </button>
                            <div class="aural-date-picker__current-month" aria-live="polite">January 2026</div>
                            <button class="aural-date-picker__nav-button"
                                    data-action="next-month"
                                    aria-label="Next month"
                                    type="button">
                                <i data-lucide="chevron-right" aria-hidden="true"></i>
                            </button>
                        </div>
                        <div class="aural-date-picker__weekdays" role="row">
                            <div class="aural-date-picker__weekday" role="columnheader" aria-label="Sunday">Su</div>
                            <div class="aural-date-picker__weekday" role="columnheader" aria-label="Monday">Mo</div>
                            <div class="aural-date-picker__weekday" role="columnheader" aria-label="Tuesday">Tu</div>
                            <div class="aural-date-picker__weekday" role="columnheader" aria-label="Wednesday">We</div>
                            <div class="aural-date-picker__weekday" role="columnheader" aria-label="Thursday">Th</div>
                            <div class="aural-date-picker__weekday" role="columnheader" aria-label="Friday">Fr</div>
                            <div class="aural-date-picker__weekday" role="columnheader" aria-label="Saturday">Sa</div>
                        </div>
                        <div class="aural-date-picker__days" role="grid" aria-label="Calendar days"></div>
                        <div class="aural-date-picker__footer">
                            <button class="aural-date-picker__footer-button" type="button" aria-label="Select today as start date">Today</button>
                            <button class="aural-date-picker__footer-button" type="button" aria-label="Clear selected dates">Clear</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="example-container">
            <div class="example-label">With Preselected Range</div>
            <div class="example-demo">
                <div class="aural-date-picker aural-date-picker--range" id="date-range-picker-2">
                    <div class="aural-date-picker__input-wrapper">
                        <input type="text"
                               class="aural-date-picker__input"
                               placeholder="Select date range"
                               readonly
                               aria-label="Select date range"
                               aria-haspopup="dialog"
                               aria-expanded="false">
                        <i data-lucide="calendar" class="aural-date-picker__icon" aria-hidden="true"></i>
                    </div>
                    <div class="aural-date-picker__calendar" role="dialog" aria-label="Date range picker">
                        <div class="aural-date-picker__header">
                            <button class="aural-date-picker__nav-button"
                                    data-action="prev-month"
                                    aria-label="Previous month"
                                    type="button">
                                <i data-lucide="chevron-left" aria-hidden="true"></i>
                            </button>
                            <div class="aural-date-picker__current-month" aria-live="polite">January 2026</div>
                            <button class="aural-date-picker__nav-button"
                                    data-action="next-month"
                                    aria-label="Next month"
                                    type="button">
                                <i data-lucide="chevron-right" aria-hidden="true"></i>
                            </button>
                        </div>
                        <div class="aural-date-picker__weekdays" role="row">
                            <div class="aural-date-picker__weekday" role="columnheader" aria-label="Sunday">Su</div>
                            <div class="aural-date-picker__weekday" role="columnheader" aria-label="Monday">Mo</div>
                            <div class="aural-date-picker__weekday" role="columnheader" aria-label="Tuesday">Tu</div>
                            <div class="aural-date-picker__weekday" role="columnheader" aria-label="Wednesday">We</div>
                            <div class="aural-date-picker__weekday" role="columnheader" aria-label="Thursday">Th</div>
                            <div class="aural-date-picker__weekday" role="columnheader" aria-label="Friday">Fr</div>
                            <div class="aural-date-picker__weekday" role="columnheader" aria-label="Saturday">Sa</div>
                        </div>
                        <div class="aural-date-picker__days" role="grid" aria-label="Calendar days"></div>
                        <div class="aural-date-picker__footer">
                            <button class="aural-date-picker__footer-button" type="button" aria-label="Select today as start date">Today</button>
                            <button class="aural-date-picker__footer-button" type="button" aria-label="Clear selected dates">Clear</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- Theme Toggle -->
    <div class="theme-toggle">
        <button class="btn btn-secondary btn-sm" onclick="toggleTheme()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="5"/>
                <line x1="12" y1="1" x2="12" y2="3"/>
                <line x1="12" y1="21" x2="12" y2="23"/>
                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                <line x1="1" y1="12" x2="3" y2="12"/>
                <line x1="21" y1="12" x2="23" y2="12"/>
                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
            </svg>
        </button>
    </div>

    <!-- Aural UI JavaScript -->
    <script src="../aural-ui.js?v=9"></script>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Theme toggle
        let isDark = true;
        function toggleTheme() {
            const themeLink = document.getElementById('theme-link');
            isDark = !isDark;
            themeLink.href = isDark ? '../dark.css' : '../light.css';
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }

        // Load saved theme
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
            isDark = savedTheme === 'dark';
            document.getElementById('theme-link').href = isDark ? '../dark.css' : '../light.css';
        }

        // Date Range Picker functionality
        function initDateRangePicker(pickerElement) {
            const input = pickerElement.querySelector('.aural-date-picker__input');
            const calendar = pickerElement.querySelector('.aural-date-picker__calendar');
            const monthDisplay = pickerElement.querySelector('.aural-date-picker__current-month');
            const daysContainer = pickerElement.querySelector('.aural-date-picker__days');
            const prevBtn = pickerElement.querySelector('[data-action="prev-month"]');
            const nextBtn = pickerElement.querySelector('[data-action="next-month"]');
            const footerBtns = pickerElement.querySelectorAll('.aural-date-picker__footer-button');
            const todayBtn = footerBtns[0];
            const clearBtn = footerBtns[1];

            if (!input || !calendar) {
                console.error('Date range picker elements not found');
                return;
            }

            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                              'July', 'August', 'September', 'October', 'November', 'December'];

            let currentDate = new Date();
            let startDate = null;
            let endDate = null;
            let hoverDate = null;

            const announcer = document.getElementById('date-range-announcer');

            function announce(message) {
                if (announcer) {
                    announcer.textContent = message;
                }
            }

            function formatDate(date) {
                if (!date) return '';
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                const year = date.getFullYear();
                return `${month}/${day}/${year}`;
            }

            function updateInput() {
                if (startDate && endDate) {
                    input.value = `${formatDate(startDate)} - ${formatDate(endDate)}`;
                } else if (startDate) {
                    input.value = formatDate(startDate);
                } else {
                    input.value = '';
                }
                console.log('Input updated:', input.value);
            }

            // For the second picker, set a preselected range (7 days)
            if (pickerElement.id === 'date-range-picker-2') {
                const today = new Date();
                startDate = new Date(today.getFullYear(), today.getMonth(), today.getDate() - 3);
                endDate = new Date(today.getFullYear(), today.getMonth(), today.getDate() + 3);
                updateInput();
            }

            function isInRange(date, start, end) {
                if (!start || !end) return false;
                const d = date.getTime();
                const s = start.getTime();
                const e = end.getTime();
                return d >= Math.min(s, e) && d <= Math.max(s, e);
            }

            function renderCalendar() {
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();

                monthDisplay.textContent = `${monthNames[month]} ${year}`;

                const firstDay = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                const today = new Date();

                daysContainer.innerHTML = '';

                // Add empty cells for days before month starts
                for (let i = 0; i < firstDay; i++) {
                    const emptyDay = document.createElement('div');
                    emptyDay.className = 'aural-date-picker__day aural-date-picker__day--other-month';
                    daysContainer.appendChild(emptyDay);
                }

                // Add days of month
                for (let day = 1; day <= daysInMonth; day++) {
                    const dayElement = document.createElement('button');
                    dayElement.className = 'aural-date-picker__day';
                    dayElement.textContent = day;
                    dayElement.type = 'button';

                    const dayDate = new Date(year, month, day);
                    const dateStr = dayDate.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

                    // Build aria-label
                    let ariaLabel = dateStr;
                    if (dayDate.toDateString() === today.toDateString()) {
                        ariaLabel += ', today';
                        dayElement.classList.add('aural-date-picker__day--today');
                    }
                    if (startDate && dayDate.toDateString() === startDate.toDateString()) {
                        ariaLabel += ', range start';
                        dayElement.classList.add('aural-date-picker__day--range-start');
                    }
                    if (endDate && dayDate.toDateString() === endDate.toDateString()) {
                        ariaLabel += ', range end';
                        dayElement.classList.add('aural-date-picker__day--range-end');
                    }

                    // Check if in range (including hover preview)
                    const previewEnd = hoverDate || endDate;
                    if (isInRange(dayDate, startDate, previewEnd)) {
                        ariaLabel += ', in selected range';
                        dayElement.classList.add('aural-date-picker__day--in-range');
                    }

                    dayElement.setAttribute('aria-label', ariaLabel);
                    dayElement.setAttribute('role', 'gridcell');

                    // Click handler
                    dayElement.addEventListener('click', (e) => {
                        e.stopPropagation();

                        console.log('Day clicked:', dayDate, 'Current state - startDate:', startDate, 'endDate:', endDate);

                        if (!startDate || (startDate && endDate)) {
                            // Start new range
                            startDate = new Date(dayDate.getTime());
                            endDate = null;
                            console.log('Starting new range. Start date:', startDate);
                            announce(`Start date selected: ${dateStr}. Now select an end date.`);
                            updateInput();
                            renderCalendar();
                        } else {
                            // Set end date
                            console.log('Setting end date...');
                            if (dayDate < startDate) {
                                // Swap if end is before start
                                endDate = new Date(startDate.getTime());
                                startDate = new Date(dayDate.getTime());
                                console.log('Swapped dates. Start:', startDate, 'End:', endDate);
                            } else {
                                endDate = new Date(dayDate.getTime());
                                console.log('End date set:', endDate);
                            }

                            updateInput();

                            const rangeStr = `${formatDate(startDate)} to ${formatDate(endDate)}`;
                            announce(`Date range selected: ${rangeStr}`);

                            console.log('Closing calendar and focusing input');
                            calendar.classList.remove('aural-date-picker__calendar--open');
                            input.setAttribute('aria-expanded', 'false');

                            // Don't re-render after selecting end date, just close
                            setTimeout(() => {
                                input.focus();
                            }, 10);
                        }
                    });

                    daysContainer.appendChild(dayElement);
                }

                lucide.createIcons();
            }

            // Toggle calendar
            input.addEventListener('click', () => {
                const isOpen = calendar.classList.toggle('aural-date-picker__calendar--open');
                input.setAttribute('aria-expanded', isOpen);
                if (isOpen) {
                    renderCalendar();
                    // Focus first day button after render
                    setTimeout(() => {
                        const firstDay = daysContainer.querySelector('.aural-date-picker__day:not(.aural-date-picker__day--other-month)');
                        if (firstDay) firstDay.focus();
                    }, 0);
                }
            });

            // Keyboard support for input
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    input.click();
                } else if (e.key === 'Escape') {
                    calendar.classList.remove('aural-date-picker__calendar--open');
                    input.setAttribute('aria-expanded', 'false');
                }
            });

            // Navigation
            prevBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                currentDate.setMonth(currentDate.getMonth() - 1);
                renderCalendar();
            });

            nextBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                currentDate.setMonth(currentDate.getMonth() + 1);
                renderCalendar();
            });

            // Today button - select today as start date
            todayBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                startDate = new Date();
                endDate = null;
                currentDate = new Date();
                updateInput();
                renderCalendar();
                announce('Today selected as start date. Now select an end date.');
            });

            // Clear button
            clearBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                startDate = null;
                endDate = null;
                hoverDate = null;
                input.value = '';
                renderCalendar();
                announce('Date selection cleared.');
            });

            // Close calendar when clicking outside
            document.addEventListener('click', (e) => {
                if (!pickerElement.contains(e.target)) {
                    calendar.classList.remove('aural-date-picker__calendar--open');
                    input.setAttribute('aria-expanded', 'false');
                    hoverDate = null;
                }
            });

            // Keyboard navigation for calendar
            calendar.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    e.preventDefault();
                    calendar.classList.remove('aural-date-picker__calendar--open');
                    input.setAttribute('aria-expanded', 'false');
                    input.focus();
                }
            });

            // Initial render
            renderCalendar();
        }

        // Initialize all date range pickers
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.aural-date-picker--range').forEach(initDateRangePicker);
        });
    </script>    <!-- Unified Theme Sync -->
    <script>
    (function() {
        // Sync theme from localStorage IMMEDIATELY
        const savedTheme = localStorage.getItem('theme') || 'dark';
        const themeLink = document.getElementById('theme-link');

        if (themeLink) {
            const isInComponents = window.location.pathname.includes('/components/');
            const relativePath = isInComponents ? '../' : './';
            const themePath = savedTheme === 'dark' ? relativePath + 'dark.css' : relativePath + 'light.css';

            console.log('Applying theme:', savedTheme, 'Path:', themePath);
            themeLink.href = themePath;
        } else {
            console.error('Theme link not found!');
        }

        // Hide theme toggle in iframe (demo.html controls theme)
        window.addEventListener('DOMContentLoaded', function() {
            try {
                if (window.self !== window.top) {
                    const themeToggle = document.querySelector('.theme-toggle');
                    if (themeToggle) {
                        themeToggle.style.display = 'none';
                    }
                }
            } catch (e) {}
        });
    })();
    </script>
</body>
</html>
