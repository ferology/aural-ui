import { Canvas, Meta, Story, Controls } from '@storybook/blocks';
import * as ColorPickerStories from './ColorPicker.stories';

<Meta of={ColorPickerStories} />

# Color Picker

A comprehensive color selection component with visual pickers, multiple input modes, preset colors, and alpha channel support. Perfect for design tools, theme customizers, and applications requiring precise color selection.

## Overview

The Color Picker component provides a full-featured interface for selecting and manipulating colors with support for multiple color formats and input methods.

**Key Features:**
- Visual saturation/lightness canvas with draggable cursor
- Hue slider with full spectrum support
- Alpha/opacity channel (optional)
- Multiple color formats: HEX, RGB, HSL
- Preset color swatches
- Manual text input for precise values
- Compact variant for space-constrained layouts
- Full keyboard accessibility
- WCAG AAA compliant

---

## Interactive Demo

<Canvas of={ColorPickerStories.Default} />

<Controls of={ColorPickerStories.Default} />

---

## Usage

### Vanilla JavaScript / HTML

```html
<!-- Full Featured Color Picker -->
<div class="aural-color-picker" id="color-picker">
  <div class="aural-color-picker__preview">
    <div class="aural-color-picker__swatch">
      <div class="aural-color-picker__swatch-color"></div>
    </div>
    <input type="text" class="aural-color-picker__value" value="#F00054" readonly>
  </div>

  <div class="aural-color-picker__canvas" role="slider" aria-label="Select saturation and lightness" tabindex="0">
    <div class="aural-color-picker__saturation"></div>
    <div class="aural-color-picker__lightness"></div>
    <div class="aural-color-picker__cursor" aria-hidden="true"></div>
  </div>

  <div class="aural-color-picker__hue" role="slider" aria-label="Select hue" aria-valuemin="0" aria-valuemax="360" tabindex="0">
    <div class="aural-color-picker__hue-handle" aria-hidden="true"></div>
  </div>

  <div class="aural-color-picker__alpha" role="slider" aria-label="Select opacity" aria-valuemin="0" aria-valuemax="100" tabindex="0">
    <div class="aural-color-picker__alpha-gradient"></div>
    <div class="aural-color-picker__alpha-handle" aria-hidden="true"></div>
  </div>

  <div class="aural-color-picker__modes" role="tablist" aria-label="Color format">
    <button class="aural-color-picker__mode aural-color-picker__mode--active" data-mode="hex" role="tab" aria-selected="true">HEX</button>
    <button class="aural-color-picker__mode" data-mode="rgb" role="tab" aria-selected="false">RGB</button>
    <button class="aural-color-picker__mode" data-mode="hsl" role="tab" aria-selected="false">HSL</button>
  </div>

  <div class="aural-color-picker__inputs" data-mode="hex" role="tabpanel">
    <div class="aural-color-picker__input-group">
      <label class="aural-color-picker__input-label">
        Hex
        <input type="text" class="aural-color-picker__input" value="F00054" maxlength="6" aria-label="Hexadecimal color value">
      </label>
    </div>
  </div>

  <div class="aural-color-picker__presets">
    <div class="aural-color-picker__preset-label">Presets</div>
    <div class="aural-color-picker__preset-grid" role="group" aria-label="Preset colors">
      <button class="aural-color-picker__preset aural-color-picker__preset--active" aria-label="Select Brand Pink: #f00054" aria-pressed="true">
        <div class="aural-color-picker__preset-color" style="background: #f00054;" aria-hidden="true"></div>
      </button>
      <button class="aural-color-picker__preset" aria-label="Select Green: #22c55e">
        <div class="aural-color-picker__preset-color" style="background: #22c55e;" aria-hidden="true"></div>
      </button>
      <!-- More presets... -->
    </div>
  </div>
</div>

<script>
// Initialize with Aural.initColorPicker() if using the framework
Aural.initColorPicker('color-picker', {
  color: '#F00054',
  alpha: true,
  mode: 'hex',
  presets: ['#f00054', '#22c55e', '#3b82f6', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899', '#14b8a6'],
  onChange: (color) => console.log('Color changed:', color)
});
</script>
```

### React

```jsx
import { useState } from 'react';
import './aural-ui.css';

function ColorPicker({ value, onChange, format = 'hex', showAlpha = false, presets = [] }) {
  const [color, setColor] = useState(value || '#F00054');
  const [mode, setMode] = useState(format);

  const handleColorChange = (newColor) => {
    setColor(newColor);
    onChange?.(newColor);
  };

  return (
    <div className="aural-color-picker">
      {/* Preview */}
      <div className="aural-color-picker__preview">
        <div className="aural-color-picker__swatch" role="img" aria-label={`Current color: ${color}`}>
          <div className="aural-color-picker__swatch-color" style={{ background: color }} />
        </div>
        <input
          type="text"
          className="aural-color-picker__value"
          value={color}
          readOnly
          aria-label="Color value"
        />
      </div>

      {/* Canvas for saturation/lightness */}
      <div
        className="aural-color-picker__canvas"
        role="slider"
        aria-label="Select saturation and lightness"
        tabIndex={0}
        onClick={(e) => {/* Handle canvas click */}}
      >
        <div className="aural-color-picker__saturation" />
        <div className="aural-color-picker__lightness" />
        <div className="aural-color-picker__cursor" aria-hidden="true" />
      </div>

      {/* Hue slider */}
      <div
        className="aural-color-picker__hue"
        role="slider"
        aria-label="Select hue"
        aria-valuemin="0"
        aria-valuemax="360"
        tabIndex={0}
      >
        <div className="aural-color-picker__hue-handle" aria-hidden="true" />
      </div>

      {/* Alpha slider (if enabled) */}
      {showAlpha && (
        <div
          className="aural-color-picker__alpha"
          role="slider"
          aria-label="Select opacity"
          aria-valuemin="0"
          aria-valuemax="100"
          tabIndex={0}
        >
          <div className="aural-color-picker__alpha-gradient" />
          <div className="aural-color-picker__alpha-handle" aria-hidden="true" />
        </div>
      )}

      {/* Format mode toggle */}
      <div className="aural-color-picker__modes" role="tablist" aria-label="Color format">
        {['hex', 'rgb', 'hsl'].map(fmt => (
          <button
            key={fmt}
            className={`aural-color-picker__mode${mode === fmt ? ' aural-color-picker__mode--active' : ''}`}
            data-mode={fmt}
            role="tab"
            aria-selected={mode === fmt}
            onClick={() => setMode(fmt)}
          >
            {fmt.toUpperCase()}
          </button>
        ))}
      </div>

      {/* Preset colors */}
      {presets.length > 0 && (
        <div className="aural-color-picker__presets">
          <div className="aural-color-picker__preset-label">Presets</div>
          <div className="aural-color-picker__preset-grid" role="group" aria-label="Preset colors">
            {presets.map((preset, i) => (
              <button
                key={i}
                className={`aural-color-picker__preset${color === preset ? ' aural-color-picker__preset--active' : ''}`}
                aria-label={`Select color: ${preset}`}
                aria-pressed={color === preset}
                onClick={() => handleColorChange(preset)}
              >
                <div
                  className="aural-color-picker__preset-color"
                  style={{ background: preset }}
                  aria-hidden="true"
                />
              </button>
            ))}
          </div>
        </div>
      )}
    </div>
  );
}

// Usage
function App() {
  const [selectedColor, setSelectedColor] = useState('#F00054');

  return (
    <ColorPicker
      value={selectedColor}
      onChange={setSelectedColor}
      format="hex"
      showAlpha={true}
      presets={['#f00054', '#22c55e', '#3b82f6', '#f59e0b']}
    />
  );
}
```

### Vue 3

```vue
<template>
  <div class="aural-color-picker">
    <!-- Preview -->
    <div class="aural-color-picker__preview">
      <div class="aural-color-picker__swatch" role="img" :aria-label="`Current color: ${modelValue}`">
        <div class="aural-color-picker__swatch-color" :style="{ background: modelValue }" />
      </div>
      <input
        type="text"
        class="aural-color-picker__value"
        :value="modelValue"
        readonly
        aria-label="Color value"
      />
    </div>

    <!-- Canvas -->
    <div
      class="aural-color-picker__canvas"
      role="slider"
      aria-label="Select saturation and lightness"
      tabindex="0"
      @click="handleCanvasClick"
    >
      <div class="aural-color-picker__saturation" />
      <div class="aural-color-picker__lightness" />
      <div class="aural-color-picker__cursor" aria-hidden="true" />
    </div>

    <!-- Hue slider -->
    <div
      class="aural-color-picker__hue"
      role="slider"
      aria-label="Select hue"
      aria-valuemin="0"
      aria-valuemax="360"
      tabindex="0"
    >
      <div class="aural-color-picker__hue-handle" aria-hidden="true" />
    </div>

    <!-- Alpha slider (if enabled) -->
    <div
      v-if="showAlpha"
      class="aural-color-picker__alpha"
      role="slider"
      aria-label="Select opacity"
      aria-valuemin="0"
      aria-valuemax="100"
      tabindex="0"
    >
      <div class="aural-color-picker__alpha-gradient" />
      <div class="aural-color-picker__alpha-handle" aria-hidden="true" />
    </div>

    <!-- Format modes -->
    <div class="aural-color-picker__modes" role="tablist" aria-label="Color format">
      <button
        v-for="fmt in ['hex', 'rgb', 'hsl']"
        :key="fmt"
        :class="['aural-color-picker__mode', { 'aural-color-picker__mode--active': format === fmt }]"
        :data-mode="fmt"
        role="tab"
        :aria-selected="format === fmt"
        @click="$emit('update:format', fmt)"
      >
        {{ fmt.toUpperCase() }}
      </button>
    </div>

    <!-- Presets -->
    <div v-if="presets.length" class="aural-color-picker__presets">
      <div class="aural-color-picker__preset-label">Presets</div>
      <div class="aural-color-picker__preset-grid" role="group" aria-label="Preset colors">
        <button
          v-for="(preset, i) in presets"
          :key="i"
          :class="['aural-color-picker__preset', { 'aural-color-picker__preset--active': modelValue === preset }]"
          :aria-label="`Select color: ${preset}`"
          :aria-pressed="modelValue === preset"
          @click="$emit('update:modelValue', preset)"
        >
          <div
            class="aural-color-picker__preset-color"
            :style="{ background: preset }"
            aria-hidden="true"
          />
        </button>
      </div>
    </div>
  </div>
</template>

<script setup>
defineProps({
  modelValue: {
    type: String,
    default: '#F00054'
  },
  format: {
    type: String,
    default: 'hex',
    validator: (value) => ['hex', 'rgb', 'hsl'].includes(value)
  },
  showAlpha: {
    type: Boolean,
    default: false
  },
  presets: {
    type: Array,
    default: () => []
  }
});

defineEmits(['update:modelValue', 'update:format']);

const handleCanvasClick = (e) => {
  // Handle canvas interaction
};
</script>

<!-- Usage -->
<template>
  <ColorPicker
    v-model="selectedColor"
    v-model:format="colorFormat"
    :show-alpha="true"
    :presets="['#f00054', '#22c55e', '#3b82f6', '#f59e0b']"
  />
</template>

<script setup>
import { ref } from 'vue';

const selectedColor = ref('#F00054');
const colorFormat = ref('hex');
</script>
```

### Svelte

```svelte
<script>
  export let value = '#F00054';
  export let format = 'hex';
  export let showAlpha = false;
  export let presets = [];

  let currentFormat = format;

  function handleColorChange(newColor) {
    value = newColor;
  }

  function handleFormatChange(newFormat) {
    currentFormat = newFormat;
  }
</script>

<div class="aural-color-picker">
  <!-- Preview -->
  <div class="aural-color-picker__preview">
    <div class="aural-color-picker__swatch" role="img" aria-label="Current color: {value}">
      <div class="aural-color-picker__swatch-color" style="background: {value};" />
    </div>
    <input
      type="text"
      class="aural-color-picker__value"
      bind:value
      readonly
      aria-label="Color value"
    />
  </div>

  <!-- Canvas -->
  <div
    class="aural-color-picker__canvas"
    role="slider"
    aria-label="Select saturation and lightness"
    tabindex="0"
    on:click={handleCanvasClick}
  >
    <div class="aural-color-picker__saturation" />
    <div class="aural-color-picker__lightness" />
    <div class="aural-color-picker__cursor" aria-hidden="true" />
  </div>

  <!-- Hue slider -->
  <div
    class="aural-color-picker__hue"
    role="slider"
    aria-label="Select hue"
    aria-valuemin="0"
    aria-valuemax="360"
    tabindex="0"
  >
    <div class="aural-color-picker__hue-handle" aria-hidden="true" />
  </div>

  <!-- Alpha slider -->
  {#if showAlpha}
    <div
      class="aural-color-picker__alpha"
      role="slider"
      aria-label="Select opacity"
      aria-valuemin="0"
      aria-valuemax="100"
      tabindex="0"
    >
      <div class="aural-color-picker__alpha-gradient" />
      <div class="aural-color-picker__alpha-handle" aria-hidden="true" />
    </div>
  {/if}

  <!-- Format modes -->
  <div class="aural-color-picker__modes" role="tablist" aria-label="Color format">
    {#each ['hex', 'rgb', 'hsl'] as fmt}
      <button
        class="aural-color-picker__mode"
        class:aural-color-picker__mode--active={currentFormat === fmt}
        data-mode={fmt}
        role="tab"
        aria-selected={currentFormat === fmt}
        on:click={() => handleFormatChange(fmt)}
      >
        {fmt.toUpperCase()}
      </button>
    {/each}
  </div>

  <!-- Presets -->
  {#if presets.length}
    <div class="aural-color-picker__presets">
      <div class="aural-color-picker__preset-label">Presets</div>
      <div class="aural-color-picker__preset-grid" role="group" aria-label="Preset colors">
        {#each presets as preset, i}
          <button
            class="aural-color-picker__preset"
            class:aural-color-picker__preset--active={value === preset}
            aria-label="Select color: {preset}"
            aria-pressed={value === preset}
            on:click={() => handleColorChange(preset)}
          >
            <div
              class="aural-color-picker__preset-color"
              style="background: {preset};"
              aria-hidden="true"
            />
          </button>
        {/each}
      </div>
    </div>
  {/if}
</div>

<!-- Usage -->
<script>
  import ColorPicker from './ColorPicker.svelte';

  let selectedColor = '#F00054';
</script>

<ColorPicker
  bind:value={selectedColor}
  format="hex"
  showAlpha={true}
  presets={['#f00054', '#22c55e', '#3b82f6', '#f59e0b']}
/>
```

---

## Variants

### Color Formats

<Canvas of={ColorPickerStories.AllFormats} />

The color picker supports three color formats:

- **HEX**: `#F00054` - Most common for web development, 6-digit hexadecimal
- **RGB**: `rgb(240, 0, 84)` - Red, Green, Blue channels (0-255)
- **HSL**: `hsl(340, 100%, 47%)` - Hue (0-360°), Saturation, Lightness (0-100%)

### With Alpha Channel

<Canvas of={ColorPickerStories.WithAlpha} />

Enable alpha/opacity control for colors with transparency.

### Compact Variant

<Canvas of={ColorPickerStories.Compact} />

Use the compact variant for space-constrained layouts or inline color selection.

### With Preset Colors

<Canvas of={ColorPickerStories.WithPresets} />

Provide quick access to commonly used or brand colors.

---

## States

### Disabled State

<Canvas of={ColorPickerStories.Disabled} />

Disabled color pickers are not interactive and appear dimmed.

```html
<div class="aural-color-picker aural-color-picker--disabled">
  <!-- Color picker markup -->
</div>
```

---

## Common Patterns

### Theme Customizer

<Canvas of={ColorPickerStories.ThemePicker} />

Allow users to customize theme colors with multiple color pickers.

### Brand Color Library

<Canvas of={ColorPickerStories.BrandColors} />

Manage brand colors with preset swatches and custom color selection.

---

## Theme Comparison

See how the color picker looks across all Aural UI themes:

<Canvas of={ColorPickerStories.ThemeComparison} />

---

## Accessibility

### Keyboard Navigation

**Canvas (Saturation/Lightness):**
- `Tab` - Focus canvas
- `Arrow Keys` - Move cursor (fine control)
- `Shift + Arrow Keys` - Move cursor faster (10px increments)
- `Enter/Space` - Select current position

**Hue/Alpha Sliders:**
- `Tab` - Focus slider
- `Left/Right Arrow` - Adjust value
- `Home/End` - Min/max values
- `Page Up/Down` - Increment by 10

**Format Modes:**
- `Tab` - Navigate between mode buttons
- `Enter/Space` - Switch format

**Presets:**
- `Tab` - Navigate between preset swatches
- `Enter/Space` - Select preset color

### Screen Reader Support

All interactive elements include proper ARIA labels:
- `role="slider"` for canvas, hue, and alpha controls
- `aria-label` describes each control's purpose
- `aria-valuemin`, `aria-valuemax`, `aria-valuenow` for slider values
- `aria-pressed` indicates active preset
- `aria-hidden="true"` for decorative visual elements
- Color values announced in readable format

### Color Contrast

- Visual controls maintain 3:1 contrast against backgrounds
- Text labels and values meet WCAG AAA (7:1+ contrast)
- Focus indicators are highly visible (minimum 3:1 contrast)
- Works with High Contrast and Colorblind themes

### Touch Targets

- All interactive areas are minimum 44x44px
- Adequate spacing between presets and controls
- Large touch-friendly handles on sliders

### Best Practices

**Do:**
- Provide color values as text for accessibility
- Include preset colors for common selections
- Show color names/labels when possible
- Display WCAG contrast ratios when selecting text/background pairs
- Support all three color formats for flexibility
- Include alpha channel for transparency needs

**Don't:**
- Rely solely on visual color representation
- Use tiny preset swatches (minimum 32x32px)
- Force a single color format
- Hide color values from screen readers
- Forget focus states on interactive elements

---

## Color Format Support

### HEX Format

Most common format for web development:
- **3-digit shorthand**: `#F00` (expands to `#FF0000`)
- **6-digit full**: `#FF0054` (standard format)
- **8-digit with alpha**: `#FF005480` (50% opacity)

**Best for:** CSS, HTML, design handoff

### RGB/RGBA Format

Red, Green, Blue channels with optional alpha:
- **RGB**: `rgb(255, 0, 84)` - values 0-255
- **RGBA**: `rgba(255, 0, 84, 0.8)` - alpha 0-1

**Best for:** Programmatic manipulation, JavaScript, transparency

### HSL/HSLA Format

Human-friendly color representation:
- **HSL**: `hsl(340, 100%, 47%)`
  - Hue: 0-360° (color wheel position)
  - Saturation: 0-100% (color intensity)
  - Lightness: 0-100% (brightness)
- **HSLA**: `hsla(340, 100%, 47%, 0.8)` - with alpha

**Best for:** Color scheme generation, theme variations, intuitive adjustments

---

## Implementation Tips

### Browser Support

- Use native `<input type="color">` as fallback
- Feature detection for EyeDropper API
- Polyfill for older browsers if needed

### Performance

- Debounce onChange callbacks during dragging
- Use `requestAnimationFrame` for smooth cursor movement
- Lazy load preset thumbnails for large color libraries

### Color Conversion

Always convert between formats internally:
```javascript
// HEX to RGB
const hexToRgb = (hex) => {
  const r = parseInt(hex.slice(1, 3), 16);
  const g = parseInt(hex.slice(3, 5), 16);
  const b = parseInt(hex.slice(5, 7), 16);
  return { r, g, b };
};

// RGB to HSL
const rgbToHsl = (r, g, b) => {
  r /= 255; g /= 255; b /= 255;
  const max = Math.max(r, g, b);
  const min = Math.min(r, g, b);
  let h, s, l = (max + min) / 2;
  // ... conversion logic
  return { h, s, l };
};
```

### Validation

- Validate hex codes (3, 6, or 8 digits)
- Clamp RGB values (0-255)
- Clamp HSL hue (0-360), saturation/lightness (0-100)
- Provide clear error feedback

### Recent Colors

Save recent colors to enhance workflow:
```javascript
const recentColors = JSON.parse(localStorage.getItem('recentColors') || '[]');
const addRecentColor = (color) => {
  const updated = [color, ...recentColors.filter(c => c !== color)].slice(0, 8);
  localStorage.setItem('recentColors', JSON.stringify(updated));
};
```

---

## API Reference

### CSS Classes

| Class | Description |
|-------|-------------|
| `.aural-color-picker` | Base container (required) |
| `.aural-color-picker--compact` | Compact variant |
| `.aural-color-picker--disabled` | Disabled state |
| `.aural-color-picker__preview` | Color preview section |
| `.aural-color-picker__swatch` | Color swatch display |
| `.aural-color-picker__swatch-color` | Actual color element |
| `.aural-color-picker__value` | Color value text input |
| `.aural-color-picker__canvas` | Saturation/lightness canvas |
| `.aural-color-picker__saturation` | Saturation gradient overlay |
| `.aural-color-picker__lightness` | Lightness gradient overlay |
| `.aural-color-picker__cursor` | Canvas cursor indicator |
| `.aural-color-picker__hue` | Hue slider container |
| `.aural-color-picker__hue-handle` | Hue slider handle |
| `.aural-color-picker__alpha` | Alpha/opacity slider container |
| `.aural-color-picker__alpha-gradient` | Alpha gradient background |
| `.aural-color-picker__alpha-handle` | Alpha slider handle |
| `.aural-color-picker__modes` | Format mode toggle buttons |
| `.aural-color-picker__mode` | Individual format button |
| `.aural-color-picker__mode--active` | Active format button |
| `.aural-color-picker__inputs` | Input fields container |
| `.aural-color-picker__inputs--rgba` | RGB input layout |
| `.aural-color-picker__inputs--hsla` | HSL input layout |
| `.aural-color-picker__input-group` | Individual input wrapper |
| `.aural-color-picker__input-label` | Input label |
| `.aural-color-picker__input` | Input field |
| `.aural-color-picker__presets` | Preset colors section |
| `.aural-color-picker__preset-label` | Presets section label |
| `.aural-color-picker__preset-grid` | Preset colors grid |
| `.aural-color-picker__preset` | Individual preset button |
| `.aural-color-picker__preset--active` | Active preset |
| `.aural-color-picker__preset-color` | Preset color element |

### JavaScript API (if using Aural.initColorPicker)

```javascript
const picker = Aural.initColorPicker('element-id', {
  color: '#F00054',           // Initial color
  alpha: true,                // Enable alpha channel
  mode: 'hex',                // Initial format: 'hex', 'rgb', 'hsl'
  presets: [],                // Array of preset colors
  recentColors: true,         // Track recent colors
  compact: false,             // Use compact variant
  onChange: (color) => {},    // Color change callback
  onModeChange: (mode) => {}  // Format change callback
});

// Methods
picker.getColor();              // Get current color (hex)
picker.setColor('#FF0000');     // Set color
picker.getColorRGB();           // Get as RGB object
picker.getColorHSL();           // Get as HSL object
picker.destroy();               // Clean up
```

---

## Related Components

- **Input** - Text input for manual color entry
- **Button** - Trigger buttons for popover pickers
- **Popover** - Container for dropdown color pickers
- **Swatch Grid** - Simple color selection from presets only
